(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1120:function(t,e,i){t.exports=i(1426)},1426:function(t,e,i){"use strict";i.r(e),i.d(e,"DataSyncListStatus",(function(){return h})),i.d(e,"DataSyncListStatusError",(function(){return g})),i.d(e,"DataSyncListStatusAttentionReason",(function(){return y})),i.d(e,"DataSyncOperationType",(function(){return F})),i.d(e,"getDataSyncClient",(function(){return B}));var n=i(0),s=i(959),r=i.n(s),o=i(165),a=function(t){return u(t)},c=function(t){return u({msg:t,error:!0})},u=i.n(o).a.isFeatureEnabled({ODB:1495})?function(t){"string"==typeof t?r.a.verbose(t):t.error?r.a.logError(t.msg):r.a.verbose(t.msg)}:function(t){},l=window.localStorage.getItem("sharepoint.datasync.nucleus.logToConsole"),d=!!l&&"TRUE"===l.toUpperCase();d&&(u=function(t){console.log("[nucleus] "+("string"==typeof t?t:t.msg))});var f=d?function(t){return t?"function"==typeof t?t().toString():t.toString():"undefined"}:function(t){return"<PRIVATE>"};function p(t){return""+(t||new Date).toISOString()}var h,g,y,v,_,S={ODB:1686},m=function(){return!1};"undefined"!=typeof DEBUG&&DEBUG&&(m=function(){return"true"===localStorage.getItem("sharepoint.datasync.nucleus.ignoreDisabledRoutes")}),function(t){t[t.InSync=1]="InSync",t[t.ChangesSaved=2]="ChangesSaved",t[t.Syncing=3]="Syncing",t[t.Attention=4]="Attention",t[t.SyncConflict=5]="SyncConflict",t[t.SettingUp=6]="SettingUp",t[t.Unsupported=7]="Unsupported",t[t.Removed=8]="Removed",t[t.Error=9]="Error",t[t.ListStatusConnectionLost=10]="ListStatusConnectionLost",t[t.ListStatusConnected=11]="ListStatusConnected"}(h||(h={})),function(t){t[t.UnknownError=0]="UnknownError"}(g||(g={})),function(t){t[t.SetupRequired=0]="SetupRequired",t[t.SignInRequired=1]="SignInRequired"}(y||(y={})),function(t){t[t.List=1]="List",t[t.ListItem=2]="ListItem",t[t.ListView=3]="ListView"}(v||(v={})),function(t){t[t.Guid=1]="Guid",t[t.Path=2]="Path"}(_||(_={}));var w={api:{recycle:{isLeaf:!0},ValidateUpdateListItem:{isLeaf:!0}}},L={api:{SetViewXml:{isLeaf:!0,flight:S}}},b={api:{"%self%":{isLeaf:!0,idType:_.Guid,flight:S,returns:v.ListItem,api:L.api},Add:{isLeaf:!0,flight:S}}},C={api:{RenderListDataAsStream:{isLeaf:!0},RenderExtendedListFormData:{isLeaf:!0},AddValidateUpdateItemUsingPath:{isLeaf:!0},GetItemById:{returns:v.ListItem,idType:_.Guid,api:w.api},items:{idType:_.Guid,returns:v.ListItem,api:w.api},Views:{isLeaf:!0,api:b.api,flight:S}}},I={api:{web:{api:{api:{GetList:{returns:v.List,idType:_.Path,api:C.api},GetListUsingPath:{returns:v.List,idType:_.Path,api:C.api},Lists:{api:{"%self%":{returns:v.List,idType:_.Guid,api:C.api},GetListUsingPath:{returns:v.List,idType:_.Path,api:C.api},GetList:{returns:v.List,idType:_.Guid,api:C.api}}}}}.api},"sp.ListHomeItemCollection.GetListHomePersonalLists":{isLeaf:!0},"SP.FavoriteLists.GetListsBy":{isLeaf:!0},"sp.RecentListCollection.GetRecentLists":{isLeaf:!0}}};function U(t){return t&&t.replace(/guid/,"").replace(/'/g,"").replace(/}/g,"").replace(/{/g,"").toLowerCase()}function N(t,e){var i=t.siteUrl,n=t.siteId,s=t.listId,r=t.listUrl,o=t.webId,c=e.syncedLists.find((function(t){var e;return(i||n)&&(!i||i===t.siteUrl)&&(!n||U(n)===U(t.siteId))&&(r||s)&&(!s||U(s)===U(t.listId))&&(!r||(null===(e=t.listUrl)||void 0===e?void 0:e.endsWith(r)))&&(!o||U(o)===U(t.webId))}));if(c&&(!c.syncState||!c.syncState.unsynced))return a("Found list: "+f((function(){return JSON.stringify(c)}))),c}var k=void 0;function O(){return void 0!==k}function D(){return!0===k}var R=i(142),T="NUCLEUS_FORCE_REFRESH",E="NUCLEUS_REFRESH_COMPLETE";var F,x,P=function(){function t(t){var e,i;this._discoveryTimeoutMs=(null===(e=t)||void 0===e?void 0:e.timeoutPeriodMs)||1e4,this._sleepBetweenRetriesMs=(null===(i=t)||void 0===i?void 0:i.sleepBetweenRetriesMs)||100}return t.prototype.refreshNucleusUrl=function(t){var e=this;if(a("Attempting to discover endpoint for user "+f(t)),void 0===window.sessionStorage.getItem("nucleus.installed"))return a("Required plugin was not installed."),Promise.resolve(void 0);var i=new R.e(window);return new Promise((function(n,s){var r=!1,o=new Date,c=function(){var e={type:T,messageData:{user:t}};r||(a("Posting message to plugin: "+f((function(){return JSON.stringify(e)}))+", time: "+(new Date).toISOString()),window.postMessage(e,"*"))};i.on(window,"message",(function(t){if(!r&&function(t){return(!t||t.source===window||null===t.source)&&(t&&t.data&&t.data.type===E)}(t)){var s=t.data.messageData;a("Got response from plugin: "+f((function(){return JSON.stringify(s)}))+" after "+(Date.now()-o.getTime())+"ms"),s&&s.retry&&!r?setTimeout(c,e._sleepBetweenRetriesMs):(i.dispose(),r=!0,n(s&&s.success&&s.user&&s.endpointData?s.endpointData:void 0))}}),!1),c(),setTimeout((function(){r||(r=!0,s("Timed out refreshing endpoint information after waiting "+e._discoveryTimeoutMs+"ms"),i.dispose())}),e._discoveryTimeoutMs)}))},t}(),j="microsoft.sharepoint.datasync.nucleus",G=function(t){return j+"."+t},A=function(){function t(){}return t.prototype.clearNucleusUserData=function(t){a("Clearing storage at '"+j+"."+f(t)+"'"),sessionStorage.removeItem(G(t)),localStorage.removeItem(G(t))},t.prototype.updateNucleusUserData=function(t,e){a("Updating storage at '"+j+"."+f(t)+"'. Data: "+f((function(){return JSON.stringify(e)})));var i=Object(n.__assign)(Object(n.__assign)({},e),{fromStorage:!0,lastUpdate:e.lastUpdate||Date.now()});sessionStorage.setItem(G(t),JSON.stringify(i)),localStorage.setItem(G(t),JSON.stringify(i))},t.prototype.getNucleusUserData=function(t){var e=sessionStorage.getItem(G(t));if(e||(e=localStorage.getItem(G(t)))&&sessionStorage.setItem(G(t),e),e)try{var i=JSON.parse(e);return a("Retrieved from storage at '"+j+"."+f(t)+"'. Data: "+f((function(){return JSON.stringify(i)}))),!i.lastUpdate||i.lastUpdate+72e5<Date.now()?(a("User expired"),void this.clearNucleusUserData(t)):i}catch(i){return void a("Error: got bad json at '"+j+"."+f(t)+"'. Data: "+f(e))}else a("Storage at '"+j+"."+f(t)+"' had no user information, either session or local")},t}(),J=function(){function t(t){this.getUserPromise=void 0,this._syncNowRequests={},this._listStatusCallbacks={},this._listStatusCallbackCount=0,this._listNotificationContext={},this.storage=t&&t.storage||new A,this.discovery=t&&t.discovery||new P,this._wsFactory=t&&t.websocketFactory||function(t){return new WebSocket(t)},this._featureCheck=t.featureCheck,this._aadUserId=t.aadUserId}return t.prototype.onRequestComplete=function(t){var e=t.httpStatus,i=t.succeeded,n=t.endpoint,s=t.resultCode,r=this._aadUserId,o=n.context;return a("requestComplete, user "+f(r)+", succeeded: "+i+", status: "+e+" "),i||(o.requestFailed=!0),"NoConnection"===s||401===e||403===e||404===e?(a("Forcing refresh, user "+f(r)+", error "+e+" "),o&&(o.shouldRetryLocalRequest=!0),this._resetUserData({url:o.userRoot,authToken:n.authToken}),!1):!i&&(!e||e>=500&&e<600)},t.prototype.getData=function(t,e,i){var s=Object(n.__assign)(Object(n.__assign)({},t),{siteId:U(t.siteId),listId:U(t.listId)});return this._getDataInternal(s,e,i)},t.prototype.getQosInfo=function(){return{dataSyncVersion:"0.1"}},t.prototype.addListStatusCallback=function(t,e,i){if(!e)throw new Error("not yet supported");return this.addListStatusCallbackAsync(t,e,i),this._listStatusCallbackCount},t.prototype.addListStatusCallbackAsync=function(t,e,i){return Object(n.__awaiter)(this,void 0,void 0,(function(){var s,r,o,a,u;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return e=this._normalizeIds(e),s=this._listStatusCallbackCount++,[4,this._getUser()];case 1:return(r=n.sent())?(o=N(e,r))?(a=this._socketIdFromList(o),this._listStatusCallbacks[s]={callback:t,options:i,listName:a},this._connectListNotifications(r,o),u=this._getNotificationPayloadFromState(o,this._listNotificationContext[a]&&this._listNotificationContext[a].lastKnownServerState||o.syncState||{currentlySyncing:!0,unsynced:!1,pendingUploads:0,inInitialSync:!1}),t([u]),[2,s]):[2,-1]:(c("Could not subscribe to list changes, user not found"),[2,-1])}}))}))},t.prototype.removeListStatusCallback=function(t){this._listStatusCallbacks[t]&&delete this._listStatusCallbacks[t]},t.prototype.isListDataSyncEnabled=function(t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var e;return Object(n.__generator)(this,(function(i){switch(i.label){case 0:return t=this._normalizeIds(t),[4,this._getUser()];case 1:return[2,!!(e=i.sent())&&!!N(t,e)]}}))}))},t.prototype._getDataInternal=function(t,e,i){return Object(n.__awaiter)(this,void 0,void 0,(function(){var s,r,o,u,l,d,h,g,y,v,_;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:if(s=new Date,r=t.url,o=t.siteId,u=t.listId,l=t.siteUrl,a("getData("+p(s)+") - Bind: "+(D()?"nucleus":O()?"spo":"unbound")+", user: "+f(this._aadUserId)+", url: "+f(r)+", siteId: "+f(o)+", siteUrl: "+f(l)+", listId: "+f(u)+" "),!(d=(D()||!O())&&this._getOperation(t)))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._tryCallingLocalEndpoint(d,t,e)];case 2:if(h=n.sent()){if(void 0===k&&(a("Binding to the local Nucleus endpoint"),k=!0),k)return a("Using local result.Total time "+(Date.now()-s.getTime())+" ms."),[2,h.result];a("Got local result, but already bound to service.")}else a("Could not call local endpoint, trying service.");return[3,4];case 3:if(g=n.sent(),D())throw c("Failed nucleus local call"),g;return[3,4];case 4:return a("Calling service."),y=new Date,[4,i()];case 5:if(v=n.sent(),_=new Date,a("Service call done after "+(_.getTime()-y.getTime())+" ms.Total request time "+(_.getTime()-s.getTime())+" ms"),d&&(void 0===k&&(a("Binding to the SPO service"),k=!1),k))throw"Error updating service binding.";return[2,v]}}))}))},t.prototype._tryCallingLocalEndpoint=function(t,e,i){return Object(n.__awaiter)(this,void 0,void 0,(function(){var s,r,o,c,u;return Object(n.__generator)(this,(function(l){switch(l.label){case 0:s=2,r=function(r){var c,u,l,d,h,g,y,v,_;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return c=new Date,[4,o._getUserOperationEndpoint(t,e)];case 1:if(u=n.sent(),l=new Date,a("Endpoint resolution time: "+(l.getTime()-c.getTime())+" ms"),!u)return[2,"break"];d=void 0,n.label=2;case 2:return n.trys.push([2,4,,5]),h=new Date,a("local endpoint call starting at "+p(h)+"."),[4,i(u)];case 3:return g=n.sent(),u.context.requestFailed?[3,5]:(y=new Date,a("Call redirected! elapsed: "+(y.getTime()-h.getTime())+" ms"),[2,{value:{result:g}}]);case 4:return v=n.sent(),d=v,[3,5];case 5:if(_=s-(r+1),u.context.shouldRetryLocalRequest&&_>0)return a("Local call failed. Retrying discovery & request. "+_+" tries remaining."),[2,"continue"];if(a("Local call failed, not retrying. Context: "+f((function(){return JSON.stringify(u.context)}))+" "),d)throw d;return[2,{value:void 0}]}}))},o=this,c=0,l.label=1;case 1:return c<s?[5,r(c)]:[3,4];case 2:if("object"==typeof(u=l.sent()))return[2,u.value];if("break"===u)return[3,4];l.label=3;case 3:return++c,[3,1];case 4:return[2]}}))}))},t.prototype._getNucleusUser=function(t){var e=(t||{}).forceRefresh,i=this.storage;return!e&&this.getUserPromise||(e&&i.clearNucleusUserData(this._aadUserId),this.getUserPromise=this._getNucleusUserWorker(t),a("Started discovery for user: "+f(this._aadUserId)+" ")),this.getUserPromise},t.prototype._getNucleusUserWorker=function(t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var e,i,s,r,o,u,l,d,p,h,g,y,v,_,S,m,w,L,b,C,I,U;return Object(n.__generator)(this,(function(N){switch(N.label){case 0:if(e=(t||{}).forceRefresh,i=void 0!==e&&e,r=(s=this).storage,o=s.discovery,u=s._aadUserId,a("Get nucleus endpoint, user: "+f(u)+", forceRefresh: "+i+" "),l=r.getNucleusUserData(u)){if(l.syncedLists.length>0)return[2,l];a("Found user, but synced - lists was empty, refreshing")}N.label=1;case 1:return N.trys.push([1,3,,4]),[4,o.refreshNucleusUrl(u)];case 2:return d=N.sent(),[3,4];case 3:return p=N.sent(),c("Failed discovery: "+p),[3,4];case 4:if(!d)return a("No Nucleus endpoint was found for this user"),[2,void 0];a("Calling synced-lists endpoint"),N.label=5;case 5:return N.trys.push([5,7,,8]),[4,fetch(d.url+"/Sync/Lists",{headers:{Authorization:d.authToken,Accept:"application/json","Content-Type":"application/json"},method:"GET"})];case 6:return h=N.sent(),[3,8];case 7:return g=N.sent(),c("Error calling synced-lists endpoint: "+g),[2,void 0];case 8:return N.trys.push([8,10,,12]),[4,h.json()];case 9:return y=N.sent(),a("synced - lists resp: "+f((function(){return JSON.stringify(y)}))+" "),v=y.d.results.map((function(t){return t.syncState?t:Object(n.__assign)(Object(n.__assign)({},t),{syncState:{currentlySyncing:!0,unsynced:!1,pendingUploads:0,refreshNeeded:!1,inInitialSync:!1}})})),l={syncedLists:v,endpoint:d},r.updateNucleusUserData(u,l),[3,12];case 10:return _=N.sent(),S=c,m="Error parsing synced - lists JSON: "+_+".",w="Payload was: ",L=f,[4,h.text()];case 11:return S.apply(void 0,[m+(w+L.apply(void 0,[N.sent()])+" ")]),[2,void 0];case 12:for(b=0,C=l.syncedLists;b<C.length;b++)for(U in I=C[b],this._listStatusCallbacks)this._listStatusCallbacks.hasOwnProperty(U)&&this._listStatusCallbacks[U].listName===this._socketIdFromList(I)&&this._connectListNotifications(l,I);return[2,l]}}))}))},t.prototype._getOperation=function(t){var e=t.url,i=t.siteId,s=t.listId,r=t.siteUrl;if(!e)return r?{operationType:t.operation,ids:{siteId:i,listId:s,siteUrl:r}}:void c("neither URL nor site URL were provided");try{var o=function(t,e){var i=new URL(t);a("getListOperationFromUrl called for url: "+f(t));var n=i.pathname.indexOf("/_api");if(-1!==n){var s=i.hostname;a("server: "+f(s));var r=i.pathname.substring(0,n);if(0!==r.length){var o=i.protocol+"//"+s+r;a("site: "+f(o));var c=i.pathname.substring(n+"/_api".length);if(0!==c.length){a("api: "+c);var u,l,d,p,h=c.split("/"),g=I,y="root";if(!g.disabled||m()){for(var S=0,w=h;S<w.length;S++){var L=w[S];if(0!==L.length){if(!g.api)return void a("Node "+y+" doesn't have any api when analyzing chunk: "+L);var b=L.match(new RegExp("([^\\(]*)(\\((\\w+=)?(\\S*?)\\)|$)"));if(!b)return void a("Regex match failed against chunk: "+L);var C=b[1],N=b[4];if(!C||!g.api[C])return void a("Node "+y+" doesn't have an api matching '"+C+"' from chunk '"+L+"'");if(g=g.api[C],y=C,N&&g.api&&g.api["%self%"]&&(g=g.api["%self%"]),g.flight&&!e(g.flight)||g.disabled&&!m())return void a("Node "+y+" is marked as disabled.");if(g.returns===v.List&&(p=g.returns,N)){if(u)throw"Found multiple list identifiers in URL";u=N,l=g.idType,a("Found list param '"+u+"' in chunk "+L)}g.isLeaf&&(d?d+="/"+y:d=y)}}if(d){var k=null;if(p)if(u&&void 0!==l){if(!(k=i.searchParams.get(u)))return void a("Found a list operation but couldn't determine the ID. Param name was: "+u)}else if(!(k=i.searchParams.get("listFullUrl")))return void a("Did not find a list or a list operation. This url is not supported");var O=l===_.Path&&k?i.protocol+"//"+i.host+decodeURIComponent(k).replace(/'/g,""):void 0;return{ids:{siteUrl:o,listId:l===_.Guid&&k?U(decodeURIComponent(k)):void 0,listUrl:O},rest:{api:c,method:d}}}a("Did not find a list method. This url is not supported")}else a("All nodes are disabled.")}else a("Did not find an api, this url is not supported")}else a("Did not find a site, this url is not supported")}else a("Did not find the api marker, this url is not supported")}(e,this._featureCheck);if(!o||!o.rest)return;return o.ids=Object(n.__assign)(Object(n.__assign)({},o.ids),{siteId:o.ids.siteId||i,listId:o.ids.listId||s,siteUrl:o.ids.siteUrl||r}),a("Found operation: "+f((function(){return JSON.stringify(o)}))+" "),o}catch(t){return void c("Failed to parse url with error: "+t)}},t.prototype._getUser=function(){return Object(n.__awaiter)(this,void 0,void 0,(function(){var t;return Object(n.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._getNucleusUser()];case 1:return[2,e.sent()];case 2:return t=e.sent(),c("Failed to get user information: "+t),[2,Promise.resolve(void 0)];case 3:return[2]}}))}))},t.prototype._triggerListSyncNow=function(t,e){var i=e.siteId,n=e.listId;if(a("Sync now: "+f((function(){return JSON.stringify(t.endpoint)}))+", List: "+f(n)+", Site: "+f(i)),n&&i)try{if(this._syncNowRequests[""+(i+n)])a("SyncNow already called for this list");else{var s=t.endpoint.url+"/Sync/Sites/"+i+"/Lists/"+n+"/SyncNow";this._syncNowRequests[""+(i+n)]=!0,fetch(s,{headers:{Authorization:t.endpoint.authToken,Accept:"application/json","Content-Type":"application/json"},method:"POST"}).catch((function(t){c("Failed to send syncnow request: "+t)}))}}catch(t){c("Failed to send syncnow request: "+t)}},t.prototype._getUserOperationEndpoint=function(t,e){var i,s;return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,o,c,u,l,d,f,p;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return r=e.url,o=e.siteUrl,c=t.rest,u=t.ids,[4,this._getUser()];case 1:return(l=n.sent())?u.listId||u.listUrl?!(d=N(u,l))||(null===(i=d.syncState)||void 0===i?void 0:i.inInitialSync)||(null===(s=d.syncState)||void 0===s?void 0:s.unsynced)?l.fromStorage?(this._resetUserData(l.endpoint),[4,this._getUser()]):[3,3]:[3,4]:[3,5]:[2,void 0];case 2:if(!(l=n.sent()))return[2,void 0];d=N(u,l),n.label=3;case 3:if(!d)return a("Found operation, but no synced list."),[2,void 0];n.label=4;case 4:if(!d.syncState||d.syncState.inInitialSync)return a("Can't redirect to this list during initial sync"),[2,void 0];this._triggerListSyncNow(l,d),n.label=5;case 5:if(f=new URL(l.endpoint.url),c&&r)(p=new URL(r)).pathname=f.pathname+"/SharePoint/_api"+c.api,t.ids.siteUrl&&(p.search=p.search+"&siteUrl="+encodeURIComponent(t.ids.siteUrl));else{if(!o)return[2,void 0];(p=new URL(o)).pathname=f.pathname+"/SharePoint"+p.pathname}return p.protocol="http",p.host=f.host,[2,{url:p.toString(),authToken:l.endpoint.authToken,context:{userRoot:l.endpoint.url},client:this}]}}))}))},t.prototype._resetUserData=function(t){var e=this._aadUserId,i=this.storage.getNucleusUserData(e);i&&i.endpoint&&i.endpoint.authToken===t.authToken&&i.endpoint.url===t.url&&(a("Resetting user "+f(e)+" "),this.storage.clearNucleusUserData(e),this._shutdownNotifications(),delete this.getUserPromise)},t.prototype._shutdownNotifications=function(t){var e=this;if(t)t.forEach((function(t){var i=e._socketIdFromList(t);if(e._listNotificationContext[i]){var n=e._listNotificationContext[i].socket;n&&(n.close(),e._listNotificationContext[i].socket=void 0),e._notifyListStateConnectionChanges(t,!1)}}));else for(var i in this._listNotificationContext)if(this._listNotificationContext.hasOwnProperty(i)){var n=this._listNotificationContext[i].socket;n&&(n.close(),this._listNotificationContext[i].socket=void 0)}},t.prototype._socketIdFromList=function(t){return t.siteId+"-"+t.listId},t.prototype._getNotificationPayloadFromState=function(t,e){return{id:t,state:e.currentlySyncing||e.inInitialSync?h.Syncing:e.pendingUploads?h.ChangesSaved:h.InSync,dataRefreshNeeded:!!e.refreshNeeded}},t.prototype._updateListSyncState=function(t,e,i,n){i=i||this._socketIdFromList(t),n=n||this._listNotificationContext[i],a("Notification: "+f((function(){return JSON.stringify(e)})));var s=this._getNotificationPayloadFromState(t,e),r=s.state,o=!n.lastSentClientState||r!==n.lastSentClientState.state;if(o&&(n.lastSentClientState={id:t,state:r,dataRefreshNeeded:!!e.refreshNeeded}),n.lastKnownServerState=e,this._listNotificationContext[i]=n,o||e.refreshNeeded)for(var u in a("Notifying listeners of new list state"),this._listStatusCallbacks)if(this._listStatusCallbacks.hasOwnProperty(u)){var l=this._listStatusCallbacks[u];if(l&&l.listName===i)try{l.callback([s])}catch(t){c("Error sending list notification to callback "+i+": "+t)}}},t.prototype._handleListStateChangeMessage=function(t,e){var i=this._socketIdFromList(t);a("Got list notification for "+f((function(){return JSON.stringify(t)}))+", listName: "+i);var n=this._listNotificationContext[i];if(n){var s=JSON.parse(e.data);this._updateListSyncState(t,s,i,n)}},t.prototype._handleListStateChangeError=function(t,e){var i=this;a("Hit a list websocket error"),this._shutdownNotifications([e]);var n=this._socketIdFromList(e);if(this._listNotificationContext[n]&&this._listNotificationContext[n].reconnectAttempts<15){setTimeout((function(){a("Attempting to reconnect websocket, attempts: "+i._listNotificationContext[n].reconnectAttempts),i._connectListNotifications(t,e)}),4e3)}else c("Not reconnecting websocket because we hit the max reconnection attempts")},t.prototype._handleListStateConnected=function(t){var e=this._socketIdFromList(t);this._listNotificationContext[e]&&(this._listNotificationContext[e].reconnectAttempts=0,this._notifyListStateConnectionChanges(t,!0))},t.prototype._notifyListStateConnectionChanges=function(t,e){var i,n=this._socketIdFromList(t);for(var s in this._listStatusCallbacks)if(this._listStatusCallbacks.hasOwnProperty(s)){var r=this._listStatusCallbacks[s];r.listName&&r.listName!==n||(null===(i=r.options)||void 0===i?void 0:i.sendConnectionNotifications)&&r.callback([{id:t,state:e?h.ListStatusConnected:h.ListStatusConnectionLost}])}},t.prototype._connectListNotifications=function(t,e){var i=this;if(!e.listId||!e.siteId)throw new Error("Cannot subscribe without list and site id");var n=this._socketIdFromList(e);if(!this._listNotificationContext[n]||!this._listNotificationContext[n].socket){var s=N(e,t);if(void 0!==s){a("Setting up notifications for "+f((function(){return JSON.stringify(e)})));var r=new URL(t.endpoint.url);r.protocol="ws",r.pathname+="/WebSocket/Sites/"+e.siteId+"/Lists/"+e.listId+"/Notifications",r.search="?authToken="+encodeURIComponent(t.endpoint.webSocketToken);var o=this._wsFactory(r.toString());this._listNotificationContext[n]?(this._listNotificationContext[n].reconnectAttempts++,this._listNotificationContext[n].socket=o):this._listNotificationContext[n]={id:e,reconnectAttempts:1,socket:o,lastKnownServerState:s.syncState},o.onopen=function(){i._handleListStateConnected(e)},o.onmessage=function(t){i._handleListStateChangeMessage(e,t)},o.onerror=function(){i._handleListStateChangeError(t,e)}}else a("User is not currenctly syncing this list.")}},t.prototype._normalizeIds=function(t){return Object(n.__assign)(Object(n.__assign)({},t),{listId:t.listId&&U(t.listId),siteId:t.siteId&&U(t.siteId),webId:t.webId&&U(t.webId)})},t}(),q=i(977);function B(t,e){return Object(q.isDataSyncEnabled)(e)?x||(x=new J({aadUserId:t,featureCheck:e})):void 0}!function(t){t[t.Unspecified=0]="Unspecified",t[t.ListQuickEdit=1]="ListQuickEdit"}(F||(F={}))},959:function(t,e,i){t.exports=i(145)}}]);
//# sourceMappingURL=index.data-sync-nucleus.js.map