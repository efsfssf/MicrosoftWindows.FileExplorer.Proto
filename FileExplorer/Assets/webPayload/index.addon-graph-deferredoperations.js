(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1366:function(e,t,r){e.exports=r(1367)},1367:function(e,t,r){"use strict";r.r(t);var n=r(1368),a=r.n(n);function i(e){return!!e.fileHandler}function o(e){return i(e)&&!!e.promoted}var c=/^(?:data|blob|javascript):/i,s=/^(?:data|http|https):/i;function u(e){return!c.test(e)}var d={svg:!0,png1x:!0,png1_5x:!0,png2x:!0};function l(e){var t,r;if(e)for(var n in e)if(d.hasOwnProperty(n)){var a=(r=e[n])&&s.test(r)?r:void 0;a&&(t||(t={}),t[n]=a)}return t}function p(e){return{file:e.file,folder:e.folder,allowMultiSelect:e.allowMultiSelect}}var f=function(){function e(e,t){this._dataRequestor=t.dataRequestor}return e.prototype.getFileHandlerData=function(e){var t=e||{},r=t.language,n=void 0===r?a.a.language:r,c=t.accessToken,s=void 0===c?void 0:c,d=t.endpoint,f=void 0===d?"":d,v=t.includePromotedApp,m=void 0!==v&&v,F=t.driveId,g=void 0===F?void 0:F,O=f+"/drive";return g&&(O="me"===g?f+"/me/drive":f+"/drives/"+g),this._dataRequestor.send({path:O+"/apps?"+(m?"select=*,promoted&":"")+"$expand=actions",apiName:"GetDriveApps",headers:{"Accept-Language":n},accessToken:s,useAuthorizationHeaders:!!s}).then((function(e){for(var t={custom:[],create:[],open:[],preview:[]},r={},n=0,a=e.value;n<a.length;n++){var c=a[n];if(i(c)){var s=m?o(c):void 0,d=c.application,f=c.id,v=c.actions,F=c.fileHandler;if(v){var g=F.fileTypeDisplayName,O=F.fileTypeIconUrl,y=F.version;if(y)for(var b={id:f,appId:d.id,actionMenuDisplayName:F.actionMenuDisplayName,displayName:d.displayName,appIcon:l(F.appIcon),version:y,fileTypeDisplayName:g,fileTypeIcon:l(F.fileTypeIcon||{png1x:O}),isPromoted:s},h=0,_=0,j=v;_<j.length;_++){var w=j[_],I=w.url;if(I&&u(I)){var E=w.displayName,D=w.shortDisplayName,x=w.icon,k=w.availableOn;if(k){var H="newFile"===w.type?"create":w.type,N={type:H,url:I,displayName:E,icon:l(x),availableOn:p(k),handler:b,id:h},T=k.file,S=T&&T.extensions;switch(H){case"custom":if(!E)continue;if(N.shortDisplayName=D,!T&&!k.folder)continue;break;case"create":if(!S||!S[0])continue;break;case"open":case"preview":if(!T)continue;if(S&&!s)for(var R=0,A=S;R<A.length;R++){var K=A[R];(r[K]||(r[K]={open:[],preview:[]}))[H].push(N)}break;default:continue}t[H].push(N),h++}}}}}}return{actions:t,preferences:r,version:4}}))},e}();t.default=f},1368:function(e,t,r){e.exports=r(159)},1411:function(e,t,r){e.exports=r(509)},1480:function(e,t,r){"use strict";r.r(t),r.d(t,"driveItemDeleteItemsBatchedOperationHandler",(function(){return g}));var n,a=r(0),i=r(208),o=r(6),c=r(1411),s=r(336),u=r(907),d=r(347),l=r(64),p=r(5),f=r(11),v=r(130),m=r(33),F=r(920);!function(e){e.Completed="completed",e.Failed="failed",e.InProgress="inProgress"}(n||(n={}));var g=Object(o.createBatchedItemsOperationHandler)({maxParallelOperationCount:4,timeout:3e5,areSameBatch:function(e,t){var r=f.driveItemKeyFacet.deserialize(e.itemKey).driveId,n=f.driveItemKeyFacet.deserialize(t.itemKey).driveId;return!!r&&!!n&&r===n}})((function(e){var t=this,r=e.items,g=Object.keys(r),O=g.map((function(e){return f.driveItemKeyFacet.deserialize(e)}));return function(e){return Object(a.__awaiter)(t,void 0,void 0,(function(){var t,f,y,b,h,_,j;return Object(a.__generator)(this,(function(w){switch(w.label){case 0:return e(Object(d.resolveItems)({items:Object(s.mapObject)(r,(function(e){e.progressItemKey;return Object(a.__assign)(Object(a.__assign)({},u.progressSizeFacet.pack({total:1,current:0})),u.progressAggregationOnlyFacet.pack(!0))}),(function(e,t){return t.progressItemKey}))})),t={value:O.map((function(e){return{id:e.itemId,deleted:{}}}))},f="",y=Object(v.n)(O[0]),[4,e(Object(m.getRawData)({url:y+"/items",method:"PATCH",body:t,qosName:"deleteItems",endpoint:O[0].endpoint,parseResponse:function(e){f=e.getResponseHeader("Location")||""}}))];case 1:w.sent(),b=0,h=!1,_=!1,Object(c.wait)(3e5).then((function(){return _=!0})),j=function(){var t;return Object(a.__generator)(this,(function(a){switch(a.label){case 0:return[4,e(Object(m.getRawData)({url:f,qosName:"getOperationStatus",endpoint:O[0].endpoint}))];case 1:return t=a.sent(),g.forEach((function(){e(Object(d.resolveItems)({items:Object(s.mapObject)(r,(function(e){e.progressItemKey;return u.progressSizeFacet.pack({total:1,current:t.percentageComplete/g.length})}),(function(e,t){return t.progressItemKey}))}))})),t.status!==n.Completed&&t.status!==n.Failed?[3,2]:(h=!0,b=t.summary.failed,[3,4]);case 2:return[4,Object(c.wait)(500)];case 3:a.sent(),a.label=4;case 4:return[2]}}))},w.label=2;case 2:return[5,j()];case 3:w.sent(),w.label=4;case 4:if(!h&&!_)return[3,2];w.label=5;case 5:if(_)throw new i.ItemOperationError({facets:Object(a.__assign)({},F.httpStatusErrorFacet.pack(408))});if(e(Object(l.invalidateItems)({items:Object(s.makeObject)(g,(function(){return[p.deletedFacet]}))})),b>0)throw new o.BatchedItemsOperationHandlerError({items:Object(s.makeObject)(g.slice(0,b),(function(){return new i.ItemOperationError({facets:Object(a.__assign)({},F.httpStatusErrorFacet.pack(500))})}))});return[2]}}))}))}}))},1503:function(e,t,r){"use strict";r.r(t),r.d(t,"fileHandlerGetItemsOperationHandler",(function(){return x})),r.d(t,"filehandlerPerExtensionGetItemsOperationHandler",(function(){return k})),r.d(t,"fetchFileHandlerData",(function(){return H}));var n=r(0),a=r(6),i=r(236),o=r(959),c=r.n(o),s=r(1366),u=r.n(s),d=r(130),l=r(33),p=r(269),f=r(356),v=r(119),m=r(36),F=r(58),g=r(143),O=r(183),y=r(928),b=r(232),h=r(13),_=r(5),j=r(7);function w(e){if("localStorage"in window)try{var t=function(e){var t=e.endpoint,r=e.driveId;return"fileHandlerCache_"+JSON.stringify({endpoint:t,driveId:r})}(e.driveAppsKey);localStorage.setItem(t,JSON.stringify(e.data))}catch(e){}}function I(e,t){var r=e.data,a=r.actions,i=r.preferences,o=r.version,c=e.signature,s=f.driveAppsKeyFacet.deserialize(t);return function(r){var u,d=new h.ItemResolver,l=function(e,t){var r={};return["custom","create","open","preview"].forEach((function(n){var a=E(e,t[n],n);r[n]=a})),r}(d,a),p=function(e,t){for(var r,a=new h.ItemResolver,i=0,o=Object.keys(e);i<o.length;i++){var c=o[i],s=e[c],u={};u.open=E(a,s.open,"open",c),u.preview=E(a,s.preview,"preview",c);for(var d=(s.open||[]).concat(s.preview||[]),l=void 0,p=0;p<d.length;p++){var m=d[p],F=m.handler,g=m&&D(m.icon)||F&&D(F.fileTypeIcon),O=F.fileTypeDisplayName||F.displayName;if(g){l={displayName:O,url:g};break}}var y=f.driveAppsExtensionKeyFacet.serialize({endpoint:t,extension:c}),b=Object(n.__assign)(Object(n.__assign)({},v.fileHandlerActionsFacet.pack(u)),v.fileHandlerFileTypeIconFacet.pack(l));a.resolveItems({items:(r={},r[y]=b,r)})}return{preferencesItemResolver:a}}(i,s.endpoint).preferencesItemResolver;d.merge(p),d.resolveItems({items:(u={},u[t]=Object(n.__assign)(Object(n.__assign)(Object(n.__assign)({},v.fileHandlerActionsFacet.pack(l)),v.fileHandlerVersionFacet.pack(o)),v.fileHandlerRawDataFacet.pack({data:e.data,signature:c})),u)}),r(d.execute())}}function E(e,t,r,a){var i,o=[];t.forEach((function(t){var r,a=t.handler,i=f.fileHandlerKeyFacet.serialize({id:a.id,appId:a.appId}),c=f.fileHandlerActionKeyFacet.serialize({handlerId:a.id,appId:a.appId,id:t.id||0}),s={displayName:a.actionMenuDisplayName,url:D(a.appIcon)},u={displayName:a.fileTypeDisplayName||a.displayName,url:D(t.icon||a.fileTypeIcon)},d=Object(n.__assign)(Object(n.__assign)({},_.displayNameFacet.pack(a.actionMenuDisplayName||a.displayName)),v.fileHandlerAppIconFacet.pack(s)),l=Object(n.__assign)(Object(n.__assign)(Object(n.__assign)(Object(n.__assign)(Object(n.__assign)(Object(n.__assign)(Object(n.__assign)({},_.displayNameFacet.pack(t.displayName||a.displayName)),_.openUrlFacet.pack(t.url)),v.fileHandlerActionAvailableOnFacet.pack(t.availableOn)),v.fileHandlerKeyFacetFacet.pack(i)),v.fileHandlerFileTypeIconFacet.pack(u)),v.fileHandlerAppIdFacet.pack(a.appId)),void 0!==a.isPromoted?Object(n.__assign)({},v.fileHandlerIsPromotedFacet.pack(a.isPromoted)):{});e.resolveItems({items:(r={},r[i]=d,r[c]=l,r)}),-1===o.indexOf(c)&&o.push(c)}));var c=f.fileHandlerActionSetKeyFacet.serialize({type:r,extension:a}),s=Object(n.__assign)({},j.childItemsFacet.pack(0===o.length?void 0:{itemKeys:o}));return e.resolveItems({items:(i={},i[c]=s,i)}),c}function D(e){var t=window.devicePixelRatio||1;return e&&(e.svg||t>=1.75&&e.png2x||t>=1.25&&e.png1_5x||e.png1x)}var x=Object(a.createSingleItemOperationHandler)()((function(e){var t=this,r=e.itemKey,a=f.driveAppsKeyFacet.deserialize(r),i=a.endpoint;return function(e){return Object(n.__awaiter)(t,void 0,void 0,(function(){var t,o;return Object(n.__generator)(this,(function(n){return t=e(Object(g.logQoS)({name:"getFileHandlersOperation"})),o={endpoint:i},[2,e(H(a)).then((function(n){n?(w({driveAppsKey:a,data:n}),e(I(n,r)),o.fileHandlerRequestEndpoint=n.signature.endpoint,o.accessTokenObtained=!0,e(t({resultType:O.ResultTypeEnum.Success,extraData:o}))):e(t({resultType:O.ResultTypeEnum.Failure,resultCode:"NoFileHandlerData",extraData:o}))})).catch((function(r){throw c.a.logError(r),e(t({resultType:O.ResultTypeEnum.Failure,extraData:o})),r}))]}))}))}})),k=Object(a.createSingleItemOperationHandler)()((function(e){var t=this,r=e.itemKey,a=f.driveAppsExtensionKeyFacet.deserialize(r).endpoint;return function(e){return Object(n.__awaiter)(t,void 0,void 0,(function(){var t;return Object(n.__generator)(this,(function(r){switch(r.label){case 0:return t=f.driveAppsKeyFacet.serialize({endpoint:a}),[4,e(Object(i.demandItems)((function(e){return e.demandItemFacet(v.fileHandlerActionsFacet,t)})))];case 1:return r.sent(),[2]}}))}))}}));function H(e){var t=e.endpoint,r=e.driveId;return function(e){var n,a={endpoint:t,driveId:r},i=e(Object(g.logQoS)({name:"fetchFileHandlerData",extraData:a})),o=e(Object(F.readConfiguration)({getUserOneDriveEndpoint:m.getUserOneDriveEndpointFacet,useOneDriveEndpoint:m.userOneDriveEndpointForFileHandlerConfigurationFacet})),c=o.getUserOneDriveEndpoint,s=o.useOneDriveEndpoint,f=Object(d.n)({endpoint:t,driveId:r}),v=new u.a({},{dataRequestor:e(l.getDataRequestor).dataRequestor}),h=Promise.resolve(t);return c&&s&&(h=e(c({endpoint:t}))),h.then((function(t){return n=t,f=Object(d.n)({endpoint:n}),a.fileHandlerRequestEndpoint=n,e(Object(p.e)(n,f,{qosExtraData:{requestor:"GetFileHandlerData",endPoint:n,driveUrl:f}}))})).then((function(t){return a.accessTokenObtained=!!t,v.getFileHandlerData({accessToken:t,endpoint:n,includePromotedApp:!0,driveId:r}).then((function(t){if(t){var o={data:t,lastModified:Date.now(),signature:{endpoint:n,includePromotedApp:!0,driveId:r}};return e(i({resultType:O.ResultTypeEnum.Success,extraData:a})),o}e(i({resultType:O.ResultTypeEnum.Failure,resultCode:"NoDataFromFileHandlerService",extraData:a}))})).catch((function(t){throw e(i(Object(y.mergeQosEndSchema)({resultType:O.ResultTypeEnum.Failure,extraData:a},Object(b.getQosEndSchemaFromError)(t)))),t}))})).catch((function(t){throw e(i(Object(y.mergeQosEndSchema)({resultType:O.ResultTypeEnum.Failure,resultCode:"getSessionTokenError",extraData:a},Object(b.getQosEndSchemaFromError)(t)))),t}))}}},509:function(e,t,r){"use strict";r.r(t);var n=r(271);for(var a in n)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(a)},906:function(e,t,r){"use strict";r.r(t),r.d(t,"httpStatusErrorFacet",(function(){return a})),r.d(t,"conflictErrorFacet",(function(){return i})),r.d(t,"offlineErrorFacet",(function(){return o})),r.d(t,"accessDeniedErrorFacet",(function(){return c})),r.d(t,"retryErrorFacet",(function(){return s})),r.d(t,"fileNotFoundErrorFacet",(function(){return u})),r.d(t,"invalidNameErrorFacet",(function(){return d})),r.d(t,"fileSizeErrorFacet",(function(){return l})),r.d(t,"emptyFolderUnsupportedFacet",(function(){return p})),r.d(t,"overQuotaErrorFacet",(function(){return f})),r.d(t,"lockMismatchErrorFacet",(function(){return v})),r.d(t,"fileLockedErrorFacet",(function(){return m})),r.d(t,"authFailureErrorFacet",(function(){return F})),r.d(t,"folderUploadUnsupportedFacet",(function(){return g})),r.d(t,"targetFolderErrorFacet",(function(){return O})),r.d(t,"malwareErrorFacet",(function(){return y})),r.d(t,"throttleErrorFacet",(function(){return b})),r.d(t,"versionMismatchFacet",(function(){return h})),r.d(t,"itemNotFoundErrorFacet",(function(){return _}));var n=r(3),a=new n.Facet("httpStatus"),i=new n.Facet("conflict"),o=new n.Facet("offlineError"),c=new n.Facet("accessDeniedError"),s=new n.Facet("retryError"),u=new n.Facet("fileNotFound"),d=new n.Facet("invalidNameError"),l=new n.Facet("fileSizeError"),p=new n.Facet("emptyFolderUnsupported"),f=new n.Facet("overQuotaError"),v=new n.Facet("lockMismatchError"),m=new n.Facet("fileLockedError"),F=new n.Facet("authFailureError"),g=new n.Facet("folderUploadUnsupported"),O=new n.Facet("targetFolderError"),y=new n.Facet("malwareError"),b=new n.Facet("throttleError"),h=new n.Facet("versionMismatch"),_=u},907:function(e,t,r){e.exports=r(56)},920:function(e,t,r){e.exports=r(906)},928:function(e,t,r){e.exports=r(943)},943:function(e,t,r){"use strict";r.r(t),r.d(t,"mergeQosEndSchema",(function(){return a}));var n=r(0);function a(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce((function(e,t){return Object(n.__assign)(Object(n.__assign)(Object(n.__assign)(Object(n.__assign)({},e),t),e.extraMetrics||t.extraMetrics?{extraMetrics:Object(n.__assign)(Object(n.__assign)({},e.extraMetrics||{}),t.extraMetrics||{})}:{}),e.extraData||t.extraData?{extraData:Object(n.__assign)(Object(n.__assign)({},e.extraData||{}),t.extraData||{})}:{})}),e)}},959:function(e,t,r){e.exports=r(145)}}]);
//# sourceMappingURL=index.addon-graph-deferredoperations.js.map